# Codex - Görev Talimatları

## Sen Kimsin
Sen "Ben İzledim" projesinin **veri taşıma uzmanı**sın. Görevin benizledim.com (Wix) sitesindeki tüm blog yazılarını scrape edip, Laravel import script'inin beklediği JSON formatına dönüştürmek.

## Temel Kurallar

1. **CLAUDE.md dosyasını oku** - Proje mimarisini anla.
2. **Mevcut dosyaları silme** - Sadece yeni dosyalar oluştur veya mevcut dosyaları güncelle.
3. **Import script'ini hiçbir şekilde değiştirme** - Zaten çalışıyor. Senin işin veriyi hazırlamak.

---

## GÖREVİN: Wix'ten Veri Çekme (Scraping)

### Görev Özeti
[benizledim.com](https://www.benizledim.com) Wix sitesindeki tüm blog yazılarını çek ve `database/data/wix-posts.json` dosyasına kaydet.

---

### Adım 1: Wix Sitesini Keşfet

Wix sitesinin blog URL yapısını analiz et:
- Ana sayfa: `https://www.benizledim.com`
- Blog sayfası: `https://www.benizledim.com/blog` (muhtemelen)
- Tekil yazı: `https://www.benizledim.com/post/yazi-basligi` (muhtemelen)

Önce siteyi ziyaret et, URL yapısını ve sayfa yapısını analiz et. Blog listesi sayfasını bul.

---

### Adım 2: Scraper Script Yaz

`scripts/scrape_wix.py` oluştur:

```
pip install requests beautifulsoup4
```

Script şunları yapmalı:

1. **Blog listesi sayfasından tüm yazı URL'lerini topla**
   - Wix blog genellikle `/blog` path'inde listelenir
   - Pagination varsa tüm sayfaları gez
   - Her yazının URL'sini bir listeye ekle

2. **Her yazı sayfasından veri çek**
   - **title**: `<h1>` veya `meta[property="og:title"]`
   - **content**: Ana yazı içeriği HTML olarak (Wix'in blog content container'ından)
   - **excerpt**: İlk paragraf veya `meta[property="og:description"]`
   - **cover_image**: Kapak görseli URL (Wix static URL'si)
   - **author**: Yazar adı (varsa)
   - **published_at**: Yayın tarihi
   - **categories**: Kategori etiketleri (varsa)
   - **tags**: Tag'ler (varsa)

3. **Yazar e-posta eşleme**
   Wix'te sadece yazar adı olacak. Aşağıdaki eşlemeyi kullan:
   ```
   "Gurur Sönmez"   → "gurur@benizledim.com"
   "İris Eryılmaz"  → "iris@benizledim.com"
   "Muhammed Muğlu" → "muhammed@benizledim.com"
   "Su Evci"        → "su@benizledim.com"
   "Alphan Karabat" → "alphan@benizledim.com"
   "Hümeyra Fidan"  → "humeyra@benizledim.com"
   ```
   Eşleşmezse `"gurur@benizledim.com"` (admin) kullan.

4. **Kategori eşleme**
   Wix'teki kategori adlarını bu listeye göre normalize et:
   - Sinema, Dizi, Belgesel, Kısa Film, Film, Netflix, Suç ve Gizem, Disney Plus
   - Birebir eşleşmiyorsa en yakın olanı kullan veya olduğu gibi bırak (import script firstOrCreate yapar)

---

### Adım 3: JSON Çıktı Formatı

`database/data/wix-posts.json` dosyasına kaydet. **Format kesinlikle şu şekilde olmalı**:

```json
{
    "exported_from": "benizledim.com (Wix)",
    "exported_at": "2026-02-20T00:00:00Z",
    "posts": [
        {
            "title": "Yazı Başlığı",
            "excerpt": "Yazının kısa özeti (max 200 karakter)",
            "content": "<p>Tam HTML içerik</p><p>Paragraflar korunmalı</p>",
            "cover_image": "https://static.wixstatic.com/media/...",
            "author_email": "gurur@benizledim.com",
            "categories": ["Sinema", "Film"],
            "tags": ["Dram"],
            "published_at": "2024-06-15T10:00:00Z",
            "view_count": 0
        }
    ]
}
```

#### Dikkat Edilecekler:
- `content` alanında HTML korunmalı (`<p>`, `<strong>`, `<em>`, `<h2>`, `<h3>`, `<a>`, `<img>` vb.)
- Wix'in kendi div/span yapılarını mümkünse temizle, ama içeriği kaybetme
- `cover_image` Wix static URL'si olarak bırak (daha sonra `wix:import-images` komutu indirecek)
- `published_at` ISO 8601 formatında olmalı
- `view_count` Wix'ten çekilemiyorsa `0` yaz
- JSON dosyası UTF-8 encoding ile kaydedilmeli (Türkçe karakterler önemli!)

---

### Adım 4: İçerik HTML Temizleme

Scrape edilen HTML'de Wix'e özgü şunlar olabilir, bunları temizle:
- `class="font_8"`, `class="wixui-rich-text__text"` gibi class'lar → kaldır
- `style="..."` inline style'lar → kaldır
- `data-*` attribute'lar → kaldır
- Boş `<span></span>` ve `<div></div>` → kaldır
- Wix image wrapper div'leri → sadece `<img>` tag'ini koru
- `<wix-image>` gibi custom element'ler → normal `<img>` yap

Ama şunları KORU:
- Paragraf yapısı (`<p>`)
- Başlıklar (`<h2>`, `<h3>`)
- Bold/Italic (`<strong>`, `<em>`)
- Linkler (`<a href="...">`)
- Görseller (`<img src="...">`)
- Listeler (`<ul>`, `<ol>`, `<li>`)
- Alıntılar (`<blockquote>`)

---

### Adım 5: Script'i Çalıştır ve Doğrula

1. Script'i çalıştır:
   ```bash
   python scripts/scrape_wix.py
   ```

2. Çıktıyı doğrula:
   - JSON valid mi? (`python -m json.tool database/data/wix-posts.json`)
   - Kaç yazı toplandı?
   - Her yazıda title, content, author_email var mı?
   - Türkçe karakterler doğru mu?

3. Sonuçları raporla:
   - Toplam yazı sayısı
   - Yazar dağılımı
   - Kategori dağılımı
   - Eksik alanlar (cover_image yok, kategori yok vb.)

---

### Bonus: Wix RSS Alternatifi

Eğer Wix sitesinde RSS aktifse (genellikle `/blog-feed.xml`), scraping yerine RSS'ten de çekebilirsin:
```
https://www.benizledim.com/blog-feed.xml
```
RSS'te genellikle title, content, pubDate, category bulunur. Ama cover_image ve author eksik olabilir.

---

### Zaten Hazır Olan Import Araçları (DOKUNMA)

Bu dosyalar zaten proje içinde var ve çalışıyor. Senin işin sadece `wix-posts.json`'ı hazırlamak:

1. `app/Console/Commands/ImportWixPosts.php` → `php artisan wix:import-posts database/data/wix-posts.json`
2. `app/Console/Commands/ImportWixImages.php` → `php artisan wix:import-images`
3. `app/Console/Commands/CleanPostContent.php` → `php artisan posts:clean-content`

Import sırası:
```bash
# 1. Yazıları import et
php artisan wix:import-posts database/data/wix-posts.json

# 2. Wix görsellerini indir
php artisan wix:import-images

# 3. HTML temizle
php artisan posts:clean-content
```

---

## ÖNEMLİ: Yapma Listesi
- ❌ Mevcut proje dosyalarını silme veya değiştirme
- ❌ Import artisan komutlarını değiştirme
- ❌ Migration veya model dosyalarına dokunma
- ❌ Agresif scraping yapma - istekler arası 1-2 saniye bekle
- ❌ Wix sitenin çalışmasını etkileyecek bir şey yapma
