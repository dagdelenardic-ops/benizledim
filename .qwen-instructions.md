# Qwen - GÃ¶rev TalimatlarÄ±

## Sen Kimsin
Sen "Ben Ä°zledim" projesinin **veri taÅŸÄ±ma uzmanÄ±**sÄ±n. GÃ¶revin Wix sitesinden (benizledim.com) blog yazÄ±larÄ±nÄ± Ã§ekip Laravel projesine import etmek.

## Temel Kurallar
1. **CLAUDE.md dosyasÄ±nÄ± oku** - Proje mimarisini anla.
2. **Mevcut dosyalarÄ± silme** - Sadece yeni dosyalar oluÅŸtur.
3. **Import script'lerini deÄŸiÅŸtirme** - Zaten Ã§alÄ±ÅŸÄ±yor.

---

## GÃ–REVÄ°N: 2 AÅŸamalÄ± Wix Blog Veri TaÅŸÄ±ma

### AÅAMA 1: Wix Velo ile Veri Export

KullanÄ±cÄ± Wix Editor'de Dev Mode aÃ§mÄ±ÅŸ durumda. Wix Velo (JavaScript) kullanarak blog veritabanÄ±ndan tÃ¼m yazÄ±larÄ± export edeceÄŸiz.

#### AdÄ±m 1a: Backend Export Fonksiyonu

KullanÄ±cÄ±dan Wix Editor'de ÅŸunu yapmasÄ±nÄ± iste:
1. Sol panelde **"GeliÅŸtirici AraÃ§larÄ±"** â†’ **Backend (Arka UÃ§)** klasÃ¶rÃ¼ne saÄŸ tÄ±kla â†’ **"Yeni .jsw dosyasÄ±"** oluÅŸtur
2. Dosya adÄ±: `export.jsw`
3. Ä°Ã§ine ÅŸu kodu yapÄ±ÅŸtÄ±r:

```javascript
// backend/export.jsw
import wixData from 'wix-data';

export async function exportAllBlogPosts() {
    let allPosts = [];
    let skip = 0;
    const limit = 50;
    
    // TÃ¼m yazÄ±larÄ± sayfalayarak Ã§ek
    while (true) {
        const results = await wixData.query("Blog/Posts")
            .skip(skip)
            .limit(limit)
            .ascending("_createdDate")
            .find();
        
        if (results.items.length === 0) break;
        
        for (const item of results.items) {
            allPosts.push({
                title: item.title || '',
                excerpt: item.excerpt || '',
                content: item.richContent || item.plainContent || '',
                cover_image: item.coverImage ? item.coverImage.src || item.coverImage : '',
                author: item.owner || item.ownerName || '',
                categories: [],
                tags: item.tags || item.hashtags || [],
                published_at: item._publishedDate || item._createdDate || '',
                view_count: item.viewCount || 0,
                slug: item.slug || '',
                wix_id: item._id || '',
            });
        }
        
        skip += limit;
        
        if (results.items.length < limit) break;
    }
    
    // Kategorileri de Ã§ek
    try {
        const categories = await wixData.query("Blog/Categories")
            .limit(100)
            .find();
        
        // Her yazÄ± iÃ§in kategorilerini bul
        for (const post of allPosts) {
            const postCategories = await wixData.query("Blog/PostCategories")
                .eq("postId", post.wix_id)
                .find();
            
            post.categories = postCategories.items.map(pc => {
                const cat = categories.items.find(c => c._id === pc.categoryId);
                return cat ? cat.label || cat.name : '';
            }).filter(c => c);
        }
    } catch (e) {
        console.log("Kategori Ã§ekme hatasÄ±:", e);
    }
    
    return {
        exported_from: "benizledim.com (Wix Velo)",
        exported_at: new Date().toISOString(),
        total_posts: allPosts.length,
        posts: allPosts,
    };
}
```

**NOT**: Wix veritabanÄ± koleksiyon adlarÄ± farklÄ± olabilir. EÄŸer "Blog/Posts" Ã§alÄ±ÅŸmazsa ÅŸunlarÄ± dene:
- `"BlogPosts"`
- `"Blog/Post"`
- `"Posts"`

KullanÄ±cÄ± Wix CMS'de hangi koleksiyonlar olduÄŸunu kontrol edebilir:
- Sol panel â†’ **Ä°Ã§erik YÃ¶netim Sistemi (CMS)** â†’ **Wix Uygulama KoleksiyonlarÄ±**

#### AdÄ±m 1b: Sayfa Kodu ile Export Tetikleme

KullanÄ±cÄ±dan bir sayfaya (Ã¶rn. Ana Sayfa) ÅŸu kodu eklemesini iste:

Sayfa koduna (`Ana Sayfa.js` veya herhangi bir sayfa):

```javascript
import { exportAllBlogPosts } from 'backend/export';

$w.onReady(function () {
    // EÄŸer URL'de ?export=true varsa export'u baÅŸlat
    if (new URLSearchParams(window.location.search).get('export') === 'true') {
        runExport();
    }
});

async function runExport() {
    console.log("Export baÅŸlÄ±yor...");
    
    try {
        const data = await exportAllBlogPosts();
        console.log(`${data.total_posts} yazÄ± bulundu`);
        
        // JSON'Ä± indirilebilir dosya olarak sun
        const jsonStr = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = 'wix-posts-export.json';
        a.click();
        
        console.log("Export tamamlandÄ±!");
    } catch (error) {
        console.error("Export hatasÄ±:", error);
        // Hata detaylarÄ±nÄ± gÃ¶ster
        console.error(JSON.stringify(error, null, 2));
    }
}
```

#### AdÄ±m 1c: Export'u Ã‡alÄ±ÅŸtÄ±r

1. Wix Editor'de **"YayÄ±nla"** veya **"Test Sitesi"** tÄ±kla
2. Siteye git ve URL'ye `?export=true` ekle: `https://www.benizledim.com?export=true`
3. TarayÄ±cÄ± `wix-posts-export.json` dosyasÄ±nÄ± indirecek
4. Ä°ndirilen dosyayÄ± projenin `database/data/` klasÃ¶rÃ¼ne koy

---

### AÅAMA 2: JSON DÃ¶nÃ¼ÅŸtÃ¼rme ve Import

Wix'ten gelen JSON formatÄ± bizim import script'inkinden farklÄ±. DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ script yaz.

#### AdÄ±m 2a: DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ Script

`scripts/convert_wix_export.py` oluÅŸtur:

```python
#!/usr/bin/env python3
"""Wix Velo export JSON'Ä±nÄ± Laravel import formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼r"""

import json
import sys
from datetime import datetime

AUTHOR_EMAIL_MAP = {
    "Gurur SÃ¶nmez": "gurur@benizledim.com",
    "gurur": "gurur@benizledim.com",
    "Ä°ris EryÄ±lmaz": "iris@benizledim.com",
    "iris": "iris@benizledim.com",
    "Muhammed MuÄŸlu": "muhammed@benizledim.com",
    "muhammed": "muhammed@benizledim.com",
    "Su Evci": "su@benizledim.com",
    "su": "su@benizledim.com",
    "Alphan Karabat": "alphan@benizledim.com",
    "alphan": "alphan@benizledim.com",
    "HÃ¼meyra Fidan": "humeyra@benizledim.com",
    "humeyra": "humeyra@benizledim.com",
    "Ben Ä°zledim": "gurur@benizledim.com",
    "BIZSSN": "gurur@benizledim.com",
    "BÄ°Z5SN": "gurur@benizledim.com",
}

EXCLUDE_CATEGORIES = {"Blog YazÄ±larÄ±", "Blog Posts", "All Posts"}

def get_author_email(author):
    if not author:
        return "gurur@benizledim.com"
    author = author.strip()
    return AUTHOR_EMAIL_MAP.get(author, "gurur@benizledim.com")

def convert_date(date_val):
    """Wix tarih formatÄ±nÄ± ISO 8601'e Ã§evir"""
    if not date_val:
        return ""
    if isinstance(date_val, dict) and '$date' in date_val:
        date_val = date_val['$date']
    try:
        if isinstance(date_val, str):
            return date_val if 'T' in date_val else date_val + "T00:00:00Z"
        return ""
    except:
        return ""

def main():
    input_file = sys.argv[1] if len(sys.argv) > 1 else 'database/data/wix-posts-export.json'
    output_file = 'database/data/wix-posts.json'
    
    print(f"ğŸ“‚ Okunuyor: {input_file}")
    with open(input_file, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    wix_posts = data.get('posts', [])
    print(f"ğŸ“Š {len(wix_posts)} yazÄ± bulundu")
    
    converted = []
    for wp in wix_posts:
        categories = [c for c in wp.get('categories', []) if c not in EXCLUDE_CATEGORIES]
        
        post = {
            "title": wp.get('title', ''),
            "excerpt": wp.get('excerpt', '')[:200] if wp.get('excerpt') else '',
            "content": wp.get('content', ''),
            "cover_image": wp.get('cover_image', ''),
            "author_email": get_author_email(wp.get('author', '')),
            "categories": categories,
            "tags": wp.get('tags', []),
            "published_at": convert_date(wp.get('published_at', '')),
            "view_count": wp.get('view_count', 0),
        }
        
        if post['title']:
            converted.append(post)
    
    converted.sort(key=lambda p: p.get('published_at', ''), reverse=True)
    
    output = {
        "exported_from": "benizledim.com (Wix)",
        "exported_at": datetime.utcnow().isoformat() + "Z",
        "total_posts": len(converted),
        "posts": converted,
    }
    
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(output, f, ensure_ascii=False, indent=2)
    
    print(f"âœ… {len(converted)} yazÄ± dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼: {output_file}")
    
    authors = {}
    for p in converted:
        a = p['author_email']
        authors[a] = authors.get(a, 0) + 1
    print("\nğŸ“Š Yazar daÄŸÄ±lÄ±mÄ±:")
    for a, c in sorted(authors.items(), key=lambda x: -x[1]):
        print(f"  {a}: {c}")

if __name__ == '__main__':
    main()
```

#### AdÄ±m 2b: Ã‡alÄ±ÅŸtÄ±r

```bash
# 1. Wix export JSON'Ä±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r
python scripts/convert_wix_export.py database/data/wix-posts-export.json

# 2. Laravel import
php artisan wix:import-posts database/data/wix-posts.json

# 3. GÃ¶rselleri indir
php artisan wix:import-images

# 4. HTML temizle
php artisan posts:clean-content
```

---

### YEDEK PLAN: Scraper ile

EÄŸer Wix Velo Ã§alÄ±ÅŸmazsa (izin sorunu, koleksiyon bulunamama vb.), hazÄ±r bir Python scraper script'i zaten var:

```bash
# Scraper ile (Playwright gerekli)
pip install playwright beautifulsoup4
playwright install chromium
python scripts/scrape_wix.py
```

Bu script `database/data/wix-posts.json`'Ä± direkt oluÅŸturur, dÃ¶nÃ¼ÅŸtÃ¼rmeye gerek kalmaz.

---

## Ã–NEMLÄ°: Yapma Listesi
- âŒ Mevcut proje dosyalarÄ±nÄ± silme veya deÄŸiÅŸtirme
- âŒ Import artisan komutlarÄ±nÄ± deÄŸiÅŸtirme
- âŒ Migration veya model dosyalarÄ±na dokunma
